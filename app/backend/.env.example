
# Soter Backend Environment Configuration

# Copy this file to .env and fill in your values.
# NEVER commit real secrets or API keys to version control.
#
# For local development, most defaults below will work out of the box.
# For production, review and update all values, especially secrets.


# Server Configuration


# Port the NestJS server will listen on
# Default: 3001 (frontend typically runs on 3000)
PORT=3001

# Node environment: development, production, or test
# Affects logging, error handling, and performance optimizations
NODE_ENV=development


# Database Configuration


# PostgreSQL connection string for Prisma
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
# Local dev default uses postgres/postgres credentials
# Production: Use a secure password and consider connection pooling
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/soter?schema=public"


# Blockchain Configuration (Stellar/Soroban)


# Stellar RPC endpoint for Soroban smart contract interactions
# Testnet: https://soroban-testnet.stellar.org
# Mainnet: https://soroban-mainnet.stellar.org
# Local: http://localhost:8000/soroban/rpc (for local Stellar node)
STELLAR_RPC_URL="https://soroban-testnet.stellar.org"

# Stellar network passphrase (auto-detected from RPC URL if not set)
# Testnet: "Test SDF Network ; September 2015"
# Mainnet: "Public Global Stellar Network ; September 2015"
# STELLAR_NETWORK_PASSPHRASE=""

# Contract ID for deployed AidEscrow contract (set after deployment)
# SOROBAN_CONTRACT_ID=""

# AI & Verification Configuration

# OpenAI API key for AI-powered need verification and insights
# Get your key from: https://platform.openai.com/api-keys
# Leave empty to disable AI features (verification will be manual)
OPENAI_API_KEY=""

# Verification mode: "mock" or "ai"
# mock: Generate mock verification scores (default for development/testing)
# ai: Use AI endpoint for real verification (requires OPENAI_API_KEY)
# Default: mock for privacy and development
VERIFICATION_MODE="mock"

# AI model to use for verification (when mode is "ai")
# Options: gpt-4, gpt-3.5-turbo, gpt-4-turbo
# OPENAI_MODEL="gpt-3.5-turbo"

# Verification score threshold (0-1) for auto-approval
# Claims with scores >= threshold will be marked as verified
VERIFICATION_THRESHOLD="0.7"


# CORS Configuration


# Comma-separated list of allowed origins for CORS (no wildcards)
# Local dev: include frontend URL(s)
# Production: set to your actual frontend/mobile domain(s) (e.g. https://app.example.com,capacitor://localhost)
# If unset in production, no cross-origin requests are allowed.
# Defaults are only applied when NODE_ENV=development or NODE_ENV=test.
CORS_ORIGINS="http://localhost:3000,http://localhost:3001"

# Allow CORS credentials (cookies/authorization headers)
# Default: false
CORS_ALLOW_CREDENTIALS="false"


# Queue & Cache Configuration (BullMQ/Redis)


# Redis connection URL for job queues and caching
# Format: redis://[username]:[password]@[host]:[port]/[database]
# Local dev: redis://localhost:6379
# Production: Use managed Redis (e.g., Redis Cloud, AWS ElastiCache)
REDIS_URL="redis://localhost:6379"

# Redis host (alternative to REDIS_URL)
REDIS_HOST="localhost"

# Redis port
REDIS_PORT="6379"

# Enable background job queues (for async verification, notifications, etc.)
# Set to "true" to enable, "false" to disable
# Note: Requires Redis to be running
QUEUE_ENABLED="true"

# Queue concurrency (number of jobs processed simultaneously)
QUEUE_CONCURRENCY="5"

# Queue job retry attempts on failure
QUEUE_MAX_RETRIES="3"


# Security & Authentication


# Secret key for JWT token signing (auto-generated if not set)
# Production: Use a strong, random secret (min 32 characters)
# Generate with: openssl rand -base64 32
JWT_SECRET="change-me-in-production-use-openssl-rand-base64-32"

# JWT token expiration time
# Format: 1h, 7d, 30d, etc.
JWT_EXPIRES_IN="7d"


# Rate Limiting & Performance


# Maximum API requests per window per IP address
# Helps prevent abuse and DoS attacks
# Default: 100 requests/minute
API_RATE_LIMIT="100"

# Time window for rate limiting in milliseconds
# Default: 60000 (1 minute)
THROTTLE_TTL="60000"

# Enable request throttling
THROTTLE_ENABLED="true"


# Monitoring & Observability


# Enable Prometheus metrics endpoint at /metrics
# Set to "true" to expose metrics, "false" to disable
# Production: Enable and use with monitoring tools
METRICS_ENABLED="false"

# Enable detailed request logging
# development: verbose logging
# production: structured JSON logs
LOG_LEVEL="debug"

# Sentry DSN for error tracking (optional)
# Get from: https://sentry.io
# SENTRY_DSN=""


# Feature Flags


# Enable Swagger API documentation at /api/docs
# Recommended: true for development, false for production
SWAGGER_ENABLED="true"

# Enable API versioning
API_VERSIONING_ENABLED="true"

# ============================================================================
# QUICK START GUIDE
# ============================================================================
#
# For local development:
#   1. Copy this file: cp .env.example .env
#   2. Most defaults work as-is if you have PostgreSQL running locally
#   3. Start the server: pnpm run start:dev
#   4. Access API docs: http://localhost:3001/api/docs
#
# For production:
#   1. Review and update all marked variables above
#   2. Use strong secrets for JWT_SECRET and database credentials
#   3. Switch STELLAR_RPC_URL to mainnet if deploying live
#   4. Disable SWAGGER_ENABLED and set appropriate CORS_ORIGINS
#   5. Enable METRICS_ENABLED for monitoring
#
# ============================================================================
